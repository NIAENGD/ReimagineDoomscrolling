const s={"claude.ai":"/new","chatgpt.com":"/","chat.deepseek.com":"/","grok.com":"/","gemini.google.com":"/app"};let n=null;function a(e){try{const o=new URL(e),t=o.hostname,r=s[t];return!!(r&&o.pathname===r&&o.searchParams.has("justTLDR"))}catch{return!1}}chrome.action.onClicked.addListener(()=>{chrome.runtime.openOptionsPage()});chrome.runtime.onMessage.addListener((e,o,t)=>{if(e.type==="OPEN_OPTIONS_PAGE"&&chrome.runtime.openOptionsPage(),e.type==="STORE_TEXT"&&(n=e.text,t({success:!0})),e.type==="RETRIEVE_TEXT"){const r=n;n=null,t({text:r})}});chrome.tabs.onUpdated.addListener(async(e,o,t)=>{if(o.status==="complete"&&t.url)try{a(t.url)&&await chrome.tabs.sendMessage(e,{type:"FROM_BACKGROUND",action:"pasteText",data:{tabId:e,url:t.url}})}catch(r){console.error("Error processing tab update:",r)}});chrome.runtime.onInstalled.addListener(e=>{if(e.reason==="install")chrome.runtime.openOptionsPage();else if(e.reason==="update"){const o=chrome.runtime.getManifest().version;console.log("Updated from",e.previousVersion,"to",o)}(e.reason==="install"||e.reason==="update")&&chrome.runtime.setUninstallURL("https://justtldr.com/please-stay")});chrome.runtime.onMessage.addListener((e,o,t)=>{if(e.type==="SUBMIT_FEEDBACK")return fetch("https://feedback-to-sheets.onrender.com/feedback/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.payload)}).then(r=>{if(!r.ok)throw new Error("Feedback submission failed");t({status:"success"})}).catch(r=>{console.error("Feedback submission error:",r),t({status:"error",error:r.message})}),!0});
